11月05日発表資料
22211379山松桜上

今回行ったこと
　今回行ったことはpicoCTFの問題「RED」を解くことである。この問題はRED.pngという名前の正方形の赤い画像が添付されており、そこからフラッグを探す問題である。赤い画像以外には何も無いためsteganographyと呼ばれる技術が使用されていると考えた。steganographyは、データを第三者に気付かれないように別のメディア（画像・音声・動画など）に埋め込む技術である。暗号が「内容を読めないようにする」ことを目的とするのに対し、steganographyは「存在そのものを隠す」ことを目的として使用される。
　steganographyで「最下位bit(LSB)」が使われる理由は、画像の色情報は、一般的にRGBそれぞれ8ビット(0〜255)の値で表されるが、このうち1bitだけを書き換えても、明るさや色の変化は1/256しか変わらないため、人間の目ではその差をほとんど識別できないためである。一方で、上位ビットを変更すると、色の変化が大きくなり、画像の一部が不自然に見える可能性が高まる。そのため画像の見た目を保ったまま情報を隠すことが出来る。
　この問題ではred.PNGに対し`strings` コマンドでファイル内の可視文字列を確認したところ、red.pngの tEXt チャンクに詩[図１]が含まれていることが分かった。[図１]
この詩の頭文字を見ると`chackLSB`となっていた。次に次にsteganographyの解析ツール`zsteg` を用いて、各ビットプレーンを調べたところ[図２]のように帰ってきた。[図２]
`b1,rgba,lsb,xy`：RGBA 各チャンネルの最下位ビット（b1）をピクセル走査順（xy）で読み取った結果として、`cGljb0NUR...==` のような長い文字列（`==` で終わる）が出力された。この文字列は`==` で終わり4の倍数という文字の構成であることから、この文字列はbase64エンコードされたデータであると考え、これをでコードするとフラッグを得ることが出来た。

　次にRSAです。RSA暗号は、「公開鍵暗号」と呼ばれる仕組みの代表例です。暗号化するための鍵（公開鍵）、復号するための鍵（秘密鍵）が対になっています。RSAにはこれには「オイラーの定理」という数学の法則が関係しており、`M^(e*d) mod n = M`という数式が成り立つ必要があります。このためにまず大きな素数(大きければ大きいほど良い)を選びます。例：`p = 3,q = 11`、これを掛けた「ｎ」`n = p × q = 33`次に「φ(n)」を求めます,φ(n) = (p−1)(q−1)、(3−1) × (11−1) = 20、そして、「φ(n)」 が互いに素である「e」という数を選びます、`e = 3`。最後に、`e × d ≡ 1 (mod φ(n))`を満たす「d」という数を求めます、`3 × d ≡ 1 (mod 20)`、"d = 7"。これにより公開鍵：(e, n) = (3, 33)、秘密鍵：(d, n) = (7, 33)が作成できました。
作成した公開鍵、秘密鍵を使用して実際に暗号化、復号化を行います。元の文「Ｍ」を「４」と置き、これを送りたい場合は暗号文「C」を以下のように作成します、‘C = Ｍ^e mod n `、C = 4^3 mod 33 = 64 mod 33 = 31。よって暗号文`C = 31`となりました。次に復号化を行います。`Ｍ = C^d mod n`、Ｍ＝31^7 mod 33 = 4。復号化できました。

次回までの課題
 　picoCTFの次の問題を解くこと。
参考文献
・Picoctfprimer : https://primer.picoctf.org/#_hashing
・Picoctf「EVEN RSA CAN BE BROKEN???」 : https://play.picoctf.org/practice/challenge/470
・Picoctf「Cookie Monster Secret Recipe」: https://play.picoctf.org/practice/challenge/469?page=2
・4枚の図解でわかる公開鍵暗 : https://staff.persol-xtech.co.jp/corporate/security/article.html?id=26

・Picoctf「RED」: https://play.picoctf.org/practice/challenge/460?page=2
・cpawctf-steganography : https://speakerdeck.com/kuroiwasi/cpawctf-steganography



echo "cGljb0==" | base64 -d

***************************************************
成り立たせなければならない、成り立たせることでeで暗号化し、dで復号化できる。
dを知らないと復号化できないが式はあるので有象無象の間違いが生み出される。


次回までの課題＋、.pngの仕組みを知る、c +でデコードするコードを作成。


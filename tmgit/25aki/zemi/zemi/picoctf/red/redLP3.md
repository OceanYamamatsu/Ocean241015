# 今回行ったこと — ステガノグラフィー解析(LP)

## 概要


steganographyは、データを第三者に気付かれないように別のメディア（画像・音声・動画など）に埋め込む技術である。暗号が「内容を読めないようにする」ことを目的とするのに対し、ステガノグラフィーは「存在そのものを隠す」ことを目的と使用される。

======================
ステガノグラフィーで「最下位ビット（LSB）」が使われる理由は、人間の感覚の“鈍感さ”をうまく利用できるためである。画像の色情報は、一般的にRGBそれぞれ8ビット（0〜255）の値で表されるが、このうち1ビットだけを書き換えても、明るさや色の変化は1/256しか変わらない。つまり、人間の目ではその差をほとんど識別できない。したがって、画像の「見た目」を保ったまま情報を隠すには、最下位ビットを利用するのが最も自然かつ安全な方法となる。

　一方で、もし上位ビット（例えば第7ビットや第6ビット）を変更すると、色の変化が大きくなり、画像の一部が不自然に見える可能性が高まる。そのため、情報を隠す際には画質への影響を最小限に抑えることができる最下位ビットが選ばれる。これにより、ステガノグラフィーの目的である「存在そのものを隠す」という点が達成される。

　また、ステガノグラフィーには「スペクトラム拡散（Spread Spectrum）」という考え方もある。これは通信分野の技術を応用したもので、情報を特定の場所に集中させず、広い範囲に分散して埋め込むことで検出を難しくする手法である。たとえば、画像全体のランダムな位置に少しずつビットを分散して埋め込むと、特定の部分を解析しただけでは情報を完全に取り出せなくなる。この方法は、ノイズや圧縮処理にも強く、秘匿性をより高めることができる。

　つまり、最下位ビットを利用するステガノグラフィーは「人間の視覚に影響を与えない」という点で優れ、スペクトラム拡散的な考え方を取り入れることで「検出や破壊に強い」ステガノグラフィーへと発展している。これらの技術は、情報隠蔽や著作権保護、電子透かしなどの分野でも広く応用されている。

============================



　この問題ではred.PNGに対し`strings` コマンド等でファイル内の可視文字列を確認したところ、PNGの tEXt チャンクに詩[図１]が含まれていることが分かった。この詩の頭文字を見ると`chackLSB`となっていた。次に次にsteganographyの解析ツール`zsteg` を用いて、各ビットプレーンを調べたところ[図２]のように帰ってきた。
これは`b1,rgba,lsb,xy`：RGBA 各チャンネルの最下位ビット（b1）をピクセル走査順（xy）で読み取った結果として、`cGljb0NUR...==` のような長い文字列（`==` で終わる）が出力された。
`==` で終わり4の倍数という文字の構成から、この文字列はbase64エンコードされたデータであると考えた、これをでコードするとフラッグを得ることが出来た。


`s`
＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋
```
$ file red.png
red.png: PNG image data, 128 x 128, 8-bit/color RGBA, non-interlaced
```
---

## 実際に行った解析手順（手順・操作と理由）
解析は「メタデータ/チャンクの確認 → ピクセルの最下位ビット（LSB）の探索 → 抽出データのデコード」の流れで行った。以下、手順と実際のコマンド出力を示す。

### 1) まずはテキストやチャンクを確認（簡易調査）

`strings` コマンド等でファイル内の可視文字列を確認したところ、PNGの tEXt チャンクに詩（Poem）が含まれていることが分かった。解析ツール 

```
$ strings red.png
IHDR
tEXtPoem
Crimson heart, vibrant and bold,
Hearts flutter at your sight.
Evenings glow softly red,
Cherries burst with sweet life.
Kisses linger with your warmth.
Love deep as merlot.
Scarlet leaves falling softly,
Bold in every stroke.x
IDATx
IEND
```

→ tEXt チャンクにテキスト情報が入っていることが確認できた。これは「metadata にメッセージがある」可能性のある典型的な兆候である。

### 2) LSB（最下位ビット）等ビットプレーンを調べる（zsteg 利用）

PNGはピクセルごとの色成分（R,G,B,A）に対して LSB 埋め込みすることが多い。代表的な解析ツール `zsteg` を用いて、各ビットプレーンを走査した。

```
$ zsteg red.png
meta Poem           .. text: "Crimson heart, vibrant and bold,\n..."
b1,rgba,lsb,xy      .. text: "cGljb0NURntyM2RfMXNfdGgzX3VsdDFtNHQzX2N1cjNfZjByXzU0ZG4zNTVffQ==..."
...
```

出力の要点：

* `meta Poem`：先に確認した tEXt チャンクの内容が表示される。
* `b1,rgba,lsb,xy`：RGBA 各チャンネルの **最下位ビット（b1）をピクセル走査順（xy）で読み取った結果**として、`cGljb0NUR...==` のような長い文字列（`==` で終わる）が出力された。

`==` で終わることや文字の構成から、この文字列は **Base64 エンコードされたデータ**であると推定できる。

### 3) 抽出データのデコード・フラグ取得

zsteg の出力から Base64 部分を取り出してデコードした。コマンドラインで一発で確認できる。

```
$ zsteg red.png | grep -o 'cGljb0NUR[^"]*' | head -n1 | base64 -d
picoCTF{r3d_1s_th3_ult1m4t3_cur3_f0r_54dn355}
```

→ これがフラグであることを確認した。

---

## 使用したツール（短評）

* `file` / `strings`：ファイルタイプや埋め込み可能なテキストチャンクの有無の確認に有用。
* `xxd` / `hexdump`：バイナリ構造の粗調査。
* `zsteg`：PNG/BMP のビットプレーン解析に強力。LSB や MSB、RGBA の組合せを自動で探索してくれるため、手作業でのビット抽出を省力化できる。
* `grep` / `base64`：zsteg で見つかった文字列の抽出とデコードに使用。
* （代替）Python + Pillow：LSB を自分で抽出したい場合にカスタム解析スクリプトを書ける。今回も同様の自作スクリプトで検証可能。

---

## 得られた知見・教訓

1. **まずは“見えるもの”を確認すること（チャンクや文字列）**
   PNG では tEXt チャンク等にヒントが残ることがあり、`strings` でまず確認するのは有効。見落としやすいが、手がかりになる。

2. **LSB（最下位ビット）の探索は優先度が高い**
   典型的なステガノグラフィー手法のひとつで、RGBA の LSB を走査すると文字列やファイル断片が見つかることが多い。

3. **出力の末尾（例：`==`）でエンコード形式を推測できる**
   出力が `==` で終わるBase64らしき文字列であれば、即座に `base64 -d` を試すと成功するケースがある（今回のように LSB → Base64 → プレーンテキスト の二段階になっている場合がある）。

4. **ツールは複数持っておく（GUI/CLI 両方）**
   `zsteg` は CLI で高速、`stegsolve` は GUI で視覚的にビットプレーンを確認しやすい。環境によって使い分ける。

5. **小さな観察（例：ファイルの最初／最後のバイト、テキストの末尾など）を怠らない**
   ほんの一文字や `=` の有無が復号手順を大きく変える。

---

## 結論

今回の課題では、PNG の tEXt チャンクを確認し、zsteg でRGBAの最下位ビットから抽出された Base64 文字列をデコードすることで、フラグ `picoCTF{r3d_1s_th3_ult1m4t3_cur3_f0r_54dn355}` を取得した。ステガノグラフィー問題では「痕跡を見つける（チャンク／可視部分）」→「疑わしいビットプレーンを抽出」→「抽出結果のエンコード形式を推測して復号」という基本フローを着実に実行することが重要であり、今回もその流れで解けた。

---

必要であれば、このレポートを **学内提出用（2000字以上等）** のフォーマットに整えて長めに拡充したり、図（コマンド出力のスクリーンショット）を挿入したりできます。どの形式で仕上げたいか教えてください。

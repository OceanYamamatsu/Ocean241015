今回行ったこと — ステガノグラフィー解析（レポート形式）

今回行ったことはpicoCTFの問題「RED」を解いたことである。この問題はRED.pngという名前付いた正方形の赤い画像が添付されておりそこからフラッグを探す問題である。この問題はステガノグラフィーと呼ばれる
ステガノグラフィーは、データの存在自体を隠蔽する技術であり、暗号が「内容を読めないようにする」ことを目的とするのに対して、ステガノグラフィーは「誰にも気付かれないように別のメディアに埋め込む」ことを目的とする。ステガノグラフィーを解析・発見する人は一般にステガ解析者（stego analyst）やステガノグラファーと呼ばれる。今回の課題では PNG 画像（red.png）に何らかの情報が埋め込まれていると想定し、メタデータの確認、ビットプレーン（特に最下位ビット：LSB）の探索、抽出データのデコードという流れで解析を行った。

対象と準備
対象ファイル：red.png（PNG形式、128×128、RGBA）
最初に file コマンドでファイル形式を確認し、strings 等で可視文字列を調べて、tEXt チャンクに詩が含まれていることを確認した。
実行例：
file red.png
→ red.png: PNG image data, 128 x 128, 8-bit/color RGBA, non-interlaced
strings red.png の出力には tEXtPoem と詩の文が含まれていた。

実際に行った解析手順（手順・操作と理由）
解析は「チャンク／可視文字列の確認 → LSB（最下位ビット）などビットプレーンの探索 → 抽出データのデコード」の順で行った。各段階で行った操作と得られた結果を以下に示す。

1. チャンク・可視文字列の確認
   まず strings でファイル内部の可視文字列を確認したところ、tEXt チャンクに以下のような詩（Poem）が含まれていることが分かった。これは PNG のメタデータ領域にデータが残されている典型的な例であり、解析の手がかりになる。
   （strings red.png の抜粋）
   tEXtPoem
   Crimson heart, vibrant and bold,
   Hearts flutter at your sight.
   Evenings glow softly red,
   Cherries burst with sweet life.
   Kisses linger with your warmth.
   Love deep as merlot.
   Scarlet leaves falling softly,
   Bold in every stroke.

2. ビットプレーン（LSBなど）の探索
   画像ステガノグラフィーの代表的手法は LSB（Least Significant Bit）を改変してデータを埋め込むものである。PNG のピクセルは各画素ごとに R, G, B, A の 8bit 値を持ち、各値の最下位ビットを変更しても人間の目ではほとんど差が分からないため、ここにビット列を隠すことが多い。今回は zsteg を使って自動的に全ビットプレーン（b1=LSB, b2 など）と各チャンネルの組合せ（R, G, B, A, RGB, RGBA 等）を走査した。

zsteg red.png の一部出力（要約）
meta Poem           .. text: "Crimson heart, vibrant and bold,\n..."
b1,rgba,lsb,xy      .. text: "cGljb0NURntyM2RfMXNfdGgzX3VsdDFtNHQzX2N1cjNfZjByXzU0ZG4zNTVffQ==cGlj..."
（他にも複数のビットプレーンからテキストやファイルらしき断片が検知されたが、解析の決め手になったのは b1,rgba,lsb の出力である）

3. 抽出データのデコードとフラグ取得
   zsteg の出力に含まれていた文字列は末尾に "==" を持ち、英数字と記号から成るため Base64 であると推定した。これを抽出して base64 -d でデコードしたところ、picoCTF のフラグが得られた。
   実行例：
   zsteg red.png | grep -o 'cGljb0NUR[^"]*' | head -n1 | base64 -d
   出力：
   picoCTF{r3d_1s_th3_ult1m4t3_cur3_f0r_54dn355}

LSB（最下位ビット）を編集するステガノグラフィーについての説明（追加）
LSB ステガノグラフィーは、画像（または音声）の各サンプル（画像では各画素の各チャンネル）の最下位ビットを隠しデータのビットに差し替える手法である。具体的な特徴は以下の通り。

・仕組み
　各画素は通常 8bit（0–255）で R, G, B（および A）を表す。これらの数値の最下位ビット（bit0）を隠したいデータのビット列に置き換えることで、元画像の見た目をほとんど変えずにデータを埋め込める。例えば RGB の three channels を使えば、1ピクセルあたり最大 3bit（RGBA なら 4bit）の情報を格納できる。128×128 の画像なら理論上は 128×128×3 = 49152 ビット（約 6.1 KB）の容量が得られる（RGBA ならさらに増える）。

・長所
　視覚的に気付きにくい。処理が単純で埋め込み・抽出ともに高速。埋め込み量を小さく制限すれば検知されにくい。

・短所・検出方法
　LSB の統計分布が変化するため、統計解析（RS解析、χ^2 テストなど）で検出される可能性がある。さらに、圧縮や画像加工（リサイズ・再圧縮）で埋め込んだビットが破壊されやすい。可逆圧縮（PNG）では直接ピクセル値を編集できるが、非可逆圧縮（JPEG）では DCT係数に埋め込む別手法が必要。

・実装上の注意点
　埋め込む際は元の LSB の分布を乱さないような手法（疑似乱数で散布する、チェックサムやヘッダで同期を取る等）を用いる。暗号化やエンコード（Base64等）を組み合わせることで、抽出後のデータの意味がすぐ分からないようにできる。今回のケースは LSB に Base64 文字列を繰り返し埋める構成になっており、LSB 抽出 → Base64 デコードという二段階で復元できた。

使用したツール（短評）
・file / strings：ファイルタイプや tEXt チャンク等のメタデータ確認に有用。
・xxd / hexdump：バイナリ構造の粗調査に使用。
・zsteg：PNG/BMP のビットプレーン探索に強力。LSB/MSB、RGBA の組合せを自動で試してくれるため発見が速い。
・grep / base64：zsteg 出力の抽出とデコードに使用。
・Python + Pillow（代替）：LSB を自作で抽出して検証する際に有用。カスタム処理やビット順（バイト内のビットエンディアン）の問題に対応可能。

得られた知見・教訓

1. 見えるものをまず確認すること（tEXt 等のチャンクは頻繁にヒントを含む）。基本的な観察が重要である。
2. LSB 探索はステガノグラフィー解析において最優先の一手である。RGBA すべてをチェックすると見落としが減る。
3. 抽出結果の形式（例：末尾に == が付くか等）でエンコード形式を推測できる。Base64 のような二次的なエンコードが施されることがあるため、デコードの順序を誤らないこと。
4. ツールは複数持っておくこと。zsteg（CLI）で特定できなければ stegsolve（GUI）で視覚確認するなど、手と目を使い分ける。
5. 小さな手がかり（1バイト目や文字列末尾）は非常に重要。たとえ数桁のズレでも復号性に直接影響するため、細部を見落とさないこと。

結論
今回の red.png の解析では、まず tEXt チャンクの存在を確認し、その後 zsteg によって RGBA の最下位ビット（b1,rgba,lsb）から Base64 文字列が見つかった。Base64 をデコードすることでフラグ picoCTF{r3d_1s_th3_ult1m4t3_cur3_f0r_54dn355} を得た。ステガノグラフィー問題の基本は「痕跡を見つける → 疑わしいビットプレーンを抽出する → 抽出結果のエンコード形式を推測して復号する」という流れであり、今回もこのフローを着実に実行することで解決できた。

必要なら、この文章を学内提出用（文字数指定あり）に合わせて長文化したり、実行コマンドのスクリーンショットや zsteg の出力全文を挿入した版に整形します。どの程度の長さで仕上げるか指示してください。
